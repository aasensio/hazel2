

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Basic Equations &mdash; Hazel 2.0beta1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Hazel 2.0beta1 documentation" href="index.html"/>
        <link rel="next" title="Ambiguities in the Hanle effect in the saturation regime" href="ambiguities.html"/>
        <link rel="prev" title="Data preparation" href="prepareData.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Hazel
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="programmatically.html">Programmatically</a></li>
<li class="toctree-l1"><a class="reference internal" href="inputOutput.html">Input/output files</a></li>
<li class="toctree-l1"><a class="reference internal" href="prepareData.html">Data preparation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Basic Equations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-geometry-for-the-scattering-event">The geometry for the scattering event</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-radiative-transfer-approach">The radiative transfer approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-multipolar-components-of-the-atomic-density-matrix">The multipolar components of the atomic density matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="#statistical-equilibrium-equations">Statistical equilibrium equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#emission-and-absorption-coefficients">Emission and absorption coefficients</a></li>
<li class="toctree-l2"><a class="reference internal" href="#inversion">Inversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#global-optimization-techniques">Global Optimization techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="#convergence">Convergence</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stopping-criterium">Stopping criterium</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ambiguities.html">Ambiguities in the Hanle effect in the saturation regime</a></li>
<li class="toctree-l1"><a class="reference internal" href="refsys.html">The reference system</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="disclaimer.html">Disclaimer</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Hazel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Basic Equations</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/equations.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="basic-equations">
<h1>Basic Equations<a class="headerlink" href="#basic-equations" title="Permalink to this headline">¶</a></h1>
<p>We consider a constant-property slab of atoms, located at a height
<span class="math">\(h\)</span> above the visible solar “surface&#8221;, in the presence of a
deterministic magnetic field of arbitrary strength <span class="math">\(B\)</span>,
inclination <span class="math">\(\theta_B\)</span> and azimuth <span class="math">\(\chi_B\)</span> (see Fig. 1).
The slab’s optical thickness at the wavelength and line of sight under
consideration is <span class="math">\(\tau\)</span>. We assume that all the atoms inside this
slab are illuminated from below by the photospheric solar continuum
radiation field, whose center-to-limb variation has been tabulated by
Pierce (2000). The ensuing anisotropic radiation pumping
produces population imbalances and quantum coherences between pairs of
magnetic sublevels, even among those pertaining to the different
<span class="math">\(J\)</span>-levels of the adopted atomic model. This atomic level
polarization and the Zeeman-induced wavelength shifts between the
<span class="math">\(\pi\)</span> (<span class="math">\(\Delta{M}=M_u-M_l=0\)</span>), <span class="math">\(\sigma_{\rm blue}\)</span>
(<span class="math">\(\Delta{M}=+1\)</span>) and <span class="math">\(\sigma_{\rm red}\)</span>
(<span class="math">\(\Delta{M}=-1\)</span>) transitions produce polarization in the emergent
spectral line radiation.</p>
<p>In order to facilitate the understanding of the code, in the following
we summarize the basic equations which allow us to calculate the
spectral line polarization taking rigorously into account the joint
action of atomic level polarization and the Hanle and Zeeman effects. To
this end, we have applied the quantum theory of spectral line
polarization, which is described in great detail in the monograph by
Landi degl&#8217;Innocenti &amp; Landolfi (2004). We have also applied several
methods of solution of the Stokes-vector transfer equation, some of
which can be considered as particular cases of the two general methods
explained in §6 of Trujillo Bueno (2003).</p>
<div class="section" id="the-geometry-for-the-scattering-event">
<h2>The geometry for the scattering event<a class="headerlink" href="#the-geometry-for-the-scattering-event" title="Permalink to this headline">¶</a></h2>
<div class="figure" id="id2">
<img alt="_images/f1.png" src="_images/f1.png" />
<p class="caption"><span class="caption-text">The <span class="math">\(Z\)</span>-axis is
placed along the vertical to the solar atmosphere. The magnetic field
vector, <span class="math">\(\mathbf{B}\)</span>, is characterized by its modulus
<span class="math">\(B\)</span>, the inclination angle <span class="math">\(\theta_B\)</span> and the azimuth
<span class="math">\(\chi_B\)</span>. The line-of-sight, indicated by the unit vector
<span class="math">\(\mathbf{\Omega}\)</span>, is characterized by the two angles
<span class="math">\(\theta\)</span> and <span class="math">\(\chi\)</span>. The reference direction for Stokes
<span class="math">\(Q\)</span> is defined by the vector <span class="math">\(\mathbf{e}_1\)</span> on the plane
perpendicular to the line-of-sight. This vector makes an angle
<span class="math">\(\gamma\)</span> with respect to the plane formed by the vertical and
the line-of-sight. In the figures showing examples of the emergent
Stokes profiles, our choice for the positive reference direction for
Stokes <span class="math">\(Q\)</span> is <span class="math">\(\gamma=90^\circ\)</span>, unless otherwise stated.
For off-limb observations, we have <span class="math">\(\theta=90^\circ\)</span>, while for
observations on the solar disk, we have <span class="math">\(\theta&lt;90^\circ\)</span>. Note
also that <span class="math">\(\chi\)</span> is generally taken to be <span class="math">\(0^\circ\)</span>.</span></p>
</div>
</div>
<div class="section" id="the-radiative-transfer-approach">
<h2>The radiative transfer approach<a class="headerlink" href="#the-radiative-transfer-approach" title="Permalink to this headline">¶</a></h2>
<p>The emergent Stokes vector
<span class="math">\(\mathbf{I}(\nu,\mathbf{\Omega})=(I,Q,U,V)^T\)</span> (with
<span class="math">\(^T\)</span>=transpose, <span class="math">\(\nu\)</span> the frequency and
<span class="math">\(\mathbf{\Omega}\)</span> the unit vector indicating the direction of
propagation of the ray) is obtained by solving the radiative transfer
equation</p>
<div class="math">
\[\frac{d}{ds}\mathbf{I}(\nu,\mathbf{\Omega}) =
\mathbf{\epsilon}(\nu,\mathbf{\Omega}) - \mathbf{K}(\nu,\mathbf{\Omega})
\mathbf{I}(\nu,\mathbf{\Omega}),
\label{eq:rad_transfer}\]</div>
<p>where <span class="math">\(s\)</span> is the geometrical distance along the ray under
consideration,
<span class="math">\(\mathbf{\epsilon}(\nu,\mathbf{\Omega})=({\epsilon}_I,{\epsilon}_Q,{\epsilon
}_U,{\epsilon}_V)^T\)</span> is the emission vector and</p>
<div class="math">
\[\begin{split}\mathbf{K} = \left( \begin{array}{cccc}
\eta_I &amp; \eta_Q &amp; \eta_U &amp; \eta_V \\
\eta_Q &amp; \eta_I &amp; \rho_V &amp; -\rho_U \\
\eta_U &amp; -\rho_V &amp; \eta_I &amp; \rho_Q \\
\eta_V &amp; \rho_U &amp; -\rho_Q &amp; \eta_I
\end{array} \right)
\label{eq:propagation}\end{split}\]</div>
<p>is the propagation matrix. Alternatively, introducing the optical
distance along the ray, <span class="math">\({\rm d}{\tau}=-{\eta_I}{\rm d}s\)</span>, one can
write the Stokes-vector transfer Eq. ([eq:rad_transfer]) in the
following two ways:</p>
<ul>
<li><p class="first">The first one, whose formal solution requires the use of the
evolution operator introduced by Landi degl&#8217;Innocenti &amp; Landi degl&#8217;Innocenti (1985),
is</p>
<div class="math">
\[{{d}\over{d{\tau}}}{\bf I}\,=\,{\bf K}^{*}
{\bf I}\,-\,{\bf S},
\label{eq:rad_transfer_peo}\]</div>
<p>where <span class="math">\({\bf K}^{*}={\bf K}/{\eta_I}\)</span> and
<span class="math">\({\bf S}=\mathbf{\epsilon}/{\eta_I}\)</span>. The formal solution of this
equation can be seen in eq. (23) of Trujillo Bueno (2003).</p>
</li>
<li><p class="first">The second one, whose formal solution does not require the use of the
above-mentioned evolution operator is
Rees et al. (1989)</p>
<div class="math">
\[{{d}\over{d{\tau}}}{\bf I}\,=\,{\bf I}\,-\,{\bf S}_{\rm eff},
\label{eq:rad_transfer_delo}\]</div>
<p>where the effective source-function vector
<span class="math">\(\,{\bf S}_{\rm eff}\,=\,{\bf S}\,-\,
{\bf K}^{'}{\bf I},\,\,\,\)</span> being
<span class="math">\(\,{\bf K}^{'}={\bf K}^{*}-{\bf 1}\)</span> (with <span class="math">\(\bf 1\)</span> the
unit matrix). The formal solution of this equation can be seen in eq.
(26) of Trujillo Bueno (2003).</p>
</li>
</ul>
<p>Once the coefficients <span class="math">\(\epsilon_I\)</span> and <span class="math">\(\epsilon_X\)</span> (with
<span class="math">\(X=Q,U,V\)</span>) of the emission vector and the coefficients
<span class="math">\(\eta_I\)</span>, <span class="math">\(\eta_X\)</span>, and <span class="math">\(\rho_X\)</span> of the
<span class="math">\(4\times4\)</span> propagation matrix are known at each point within the
medium it is possible to solve formally Eq. ([eq:rad_transfer_peo]) or
Eq. ([eq:rad_transfer_delo]) for obtaining the emergent Stokes
profiles for any desired line of sight. Our computer program considers
the following levels of sophistication for the solution of the radiative
transfer equation:</p>
<ul>
<li><p class="first"><em>Numerical Solutions</em>. The most general case, where the properties of
the slab vary along the ray path, has to be solved numerically. To
this end, two efficient and accurate methods of solution of the
Stokes-vector transfer equation are those proposed by
Trujillo Bueno (2003) (see his eqs. (24) and (27),
respectively). The starting points for the development of these two
numerical methods were Eq. ([eq:rad_transfer_peo]) and Eq.
([eq:rad_transfer_delo]), respectively. Both methods can be
considered as generalizations, to the Stokes-vector transfer case, of
the well-known short characteristics method for the solution of the
standard (scalar) transfer equation.</p>
</li>
<li><p class="first"><em>Exact analytical solution of the problem of a constant-property slab
including the magneto-optical terms of the propagation matrix</em>. For
the general case of a constant-property slab of arbitrary optical
thickness we actually have the following analytical solution, which
can be easily obtained as a particular case of eq. (24) of
Trujillo Bueno (2003):</p>
<div class="math">
\[{\bf I}={\rm e}^{-{\mathbf{K}^{*}}\tau}\,{\bf I}_{\rm sun}\,+\,\left[{\mathbf{K}^{*}}\right]^{-1}\,
\left( \mathbf{1} - {\rm e}^{-{\mathbf{K}^{*}}\tau} \right) \,\mathbf{S},
\label{eq:slab_peo}\]</div>
<p>where <span class="math">\(\mathbf{I}_{\rm sun}\)</span> is the Stokes vector that
illuminates the slab’s boundary that is most distant from the
observer. We point out that the exponential of the propagation matrix
<span class="math">\({\mathbf{K}^{*}}\)</span> has an analytical expression similar to eq.
(8.23) in Landi degl&#8217;Innocenti &amp; Landolfi (2004).</p>
</li>
<li><p class="first"><em>Approximate analytical solution of the problem of a
constant-property slab including the magneto-optical terms of the
propagation matrix</em>. An approximate analytical solution to the
constant-property slab problem can be easily obtained as a particular
case of eq. (27) of Trujillo Bueno (2003):</p>
<div class="math">
\[\mathbf{I} = \left[ \mathbf{1}+\Psi_0 \mathbf{K}' \right]^{-1} \left[ \left(
e^{-\tau} \mathbf{1} - \Psi_M \mathbf{K}' \right) \mathbf{I}_{\rm sun} +
(\Psi_M+\Psi_0) \mathbf{S} \right],
\label{eq:slab_delo}\]</div>
<p>where the coefficients <span class="math">\(\Psi_M\)</span> and <span class="math">\(\Psi_0\)</span> depend only
on the optical thickness of the slab at the frequency and
line-of-sight under consideration, since their expressions are:</p>
<div class="math">
\[\begin{split}\begin{aligned}
\Psi_M&amp;=&amp; \frac{1-e^{-\tau}}{\tau} - e^{-\tau},\nonumber \\
\Psi_0 &amp;=&amp;1-\frac{1-e^{-\tau}}{\tau}.\end{aligned}\end{split}\]</div>
<p>Note that Eq. ([eq:slab_delo]) for the emergent Stokes vector is the
one used by Trujillo Bueno &amp; Asensio Ramos (2007) for investigating
the impact of atomic level polarization on the Stokes profiles of the
He i 10830 Å&nbsp;multiplet. We point out that, strictly speaking, it can
be considered only as the exact analytical solution of the
optically-thin constant-property slab problem <a href="#id3"><span class="problematic" id="id4"><span id="id1"></span>[3]_</span></a>. The reason why
Eq. ([eq:slab_delo]) is, in general, an approximate expression for
calculating the emergent Stokes vector is because its derivation
assumes that the Stokes vector within the slab varies linearly with
the optical distance. However, it provides a fairly good
approximation to the emergent Stokes profiles (at least for all the
problems we have investigated in this paper). Moreover, the results
of fig. 2 of Trujillo Bueno &amp; Asensio Ramos (2007) remain also
virtually the same when using instead the exact Eq. ([eq:slab_peo]),
which from a computational viewpoint is significantly less efficient
than the approximate Eq. ([eq:slab_delo]).</p>
</li>
<li><p class="first"><em>Exact analytical solution of the problem of a constant-property slab
when neglecting the second-order terms of the Stokes-vector transfer
equation</em>. Simplified expressions for the emergent Stokes vector can
be obtained when <span class="math">\(\epsilon_I{\gg}\epsilon_X\)</span> and
<span class="math">\(\eta_I{\gg}(\eta_X,\rho_X)\)</span>, which justifies to neglect the
second-order terms of Eq. ([eq:rad_transfer]). The resulting
approximate formulae for the emergent Stokes parameters are given by
eqs. (9) and (10) of Trujillo Bueno &amp; Asensio Ramos (2007), which
are identical to those used by Trujillo Bueno et al. (2005)
for modeling the Stokes profiles observed in solar chromospheric
spicules. We point out that there is a typing error in the sentence
that introduces such eqs. (9) and (10) in
Trujillo Bueno &amp; Asensio Ramos (2007), since they are obtained only
when the above-mentioned second-order terms are neglected in Eq.
([eq:rad_transfer]), although it is true that there are no
magneto-optical terms in the resulting equations.</p>
</li>
<li><p class="first"><em>Optically thin limit</em>. Finally, the most simple solution is obtained
when taking the optically thin limit (<span class="math">\(\tau{\ll}1\)</span>) in the
equations reported in the previous point, which lead to the equations
(11) and (12) of Trujillo Bueno &amp; Asensio Ramos (2007). Note that if
<span class="math">\(\mathbf{I}_{\rm sun}=0\)</span> (i.e., <span class="math">\(I_0=X_0=0\)</span>), then such
optically thin equations imply that
<span class="math">\({X/I}\,{\approx}\,{\epsilon_X}/{\epsilon_I}\)</span>.</p>
</li>
</ul>
<p>The coefficients of the emission vector and of the propagation matrix
depend on the multipolar components, <span class="math">\(\rho^K_Q(J,J^{'})\)</span>, of the
atomic density matrix. Let us recall now the meaning of these physical
quantities and how to calculate them in the presence of an arbitrary
magnetic field under given illumination conditions.</p>
</div>
<div class="section" id="the-multipolar-components-of-the-atomic-density-matrix">
<h2>The multipolar components of the atomic density matrix<a class="headerlink" href="#the-multipolar-components-of-the-atomic-density-matrix" title="Permalink to this headline">¶</a></h2>
<p>We quantify the atomic polarization of the atomic levels using the
multipolar components of the atomic density matrix. We assume that the
atom can be correctly described under the framework of the
<span class="math">\(L\)</span>-<span class="math">\(S\)</span> coupling
Condon &amp; Shortley (1935). The different
<span class="math">\(J\)</span>-levels are grouped in terms with well defined values of the
electronic angular momentum <span class="math">\(L\)</span> and the spin <span class="math">\(S\)</span>. We neglect
the influence of hyperfine structure and assume that the energy
separation between the <span class="math">\(J\)</span>-levels pertaining to each term is very
small in comparison with the energy difference between different terms.
Therefore, we allow for coherences between different <span class="math">\(J\)</span>-levels
pertaining to the same term but not between the <span class="math">\(J\)</span>-levels
pertaining to different terms. As a result, we can represent the atom
under the formalism of the multi-term atom discussed by
Landi degl&#8217;Innocenti &amp; Landolfi (2004).</p>
<p>In the absence of magnetic fields the energy eigenvectors can be written
using Dirac’s notation as <span class="math">\(|\beta L S J M\rangle\)</span>, where
<span class="math">\(\beta\)</span> indicates a set of inner quantum numbers specifying the
electronic configuration. In general, if a magnetic field of arbitrary
strength is present, the vectors <span class="math">\(|\beta L S J M\rangle\)</span> are no
longer eigenfunctions of the total Hamiltonian and <span class="math">\(J\)</span> is no
longer a good quantum number. In this case, the eigenfunctions of the
full Hamiltonian can be written as the following linear combination:</p>
<div class="math">
\[\label{eq:eigenfunctions_total_hamiltonian}
|\beta L S j M\rangle = \sum_J C_J^j(\beta L S, M) |\beta L S J M\rangle,\]</div>
<p>where <span class="math">\(j\)</span> is a pseudo-quantum number which is used for labeling
the energy eigenstates belonging to the subspace corresponding to
assigned values of the quantum numbers <span class="math">\(\beta\)</span>, <span class="math">\(L\)</span>,
<span class="math">\(S\)</span>, and <span class="math">\(M\)</span>, and where the coefficients <span class="math">\(C_J^j\)</span> can
be chosen to be real.</p>
<p>In the presence of a magnetic field sufficiently weak so that the
magnetic energy is much smaller than the energy intervals between the
<span class="math">\(J\)</span>-levels, the energy eigenvectors are still of the form
<span class="math">\(|\beta L S J M\rangle\)</span>
(<span class="math">\(C_J^j(\beta L S, M) \approx \delta_{Jj}\)</span>), and the splitting of
the magnetic sublevels pertaining to each <span class="math">\(J\)</span>-level is linear with
the magnetic field strength. For stronger magnetic fields, we enter the
incomplete Paschen-Back effect regime in which the energy eigenvectors
are of the general form given by Eq.
([eq:eigenfunctions_total_hamiltonian]), and the splitting among the
various <span class="math">\(M\)</span>-sublevels is no longer linear with the magnetic
strength. If the magnetic field strength is further increased we
eventually reach the so-called complete Paschen-Back effect regime,
where the energy eigenvectors are of the form
<span class="math">\(|L S M_L M_S\rangle\)</span> and each <span class="math">\(L\)</span>-<span class="math">\(S\)</span> term splits
into a number of components, each of which corresponding to particular
values of (<span class="math">\(M_L+2M_S\)</span>).</p>
<p>Within the framework of the multi-term atom model the atomic
polarization of the energy levels is described with the aid of the
density matrix elements</p>
<div class="math">
\[\rho^{\beta L S}(jM,j'M') = \langle \beta L S j M | \rho | \beta L S j' M'\rangle,\]</div>
<p>where <span class="math">\(\rho\)</span> is the atomic density matrix operator. Using the
expression of the eigenfunctions of the total Hamiltonian given by Eq.
([eq:eigenfunctions_total_hamiltonian]), the density matrix elements
can be rewritten as:</p>
<div class="math">
\[\rho^{\beta L S}(jM,j'M') = \sum_{JJ'} C_J^j(\beta L S, M) C_{J'}^{j'}(\beta L
S, M') \rho^{\beta L S}(JM,J'M'),\]</div>
<p>where <span class="math">\(\rho^{\beta L S}(JM,J'M')\)</span> are the density matrix elements
on the basis of the eigenvectors <span class="math">\(| \beta L S J M\rangle\)</span>.</p>
<p>Following Landi degl&#8217;Innocenti &amp; Landolfi (2004), it is helpful to use the
spherical statistical tensor representation, which is related to the
previous one by the following linear combination:</p>
<div class="math">
\[\begin{split}\begin{aligned}
{^{\beta LS}\rho^K_Q(J,J')} &amp;=&amp; \sum_{jj'MM'} C_J^j(\beta L S, M)
C_{J'}^{j'}(\beta L S, M') \nonumber \\
&amp;\times&amp; (-1)^{J-M} \sqrt{2K+1} { \left(\begin{array}{ccc}
J&amp;J'&amp;K\\
M&amp;-M'&amp;-Q
\end{array}\right) }
\rho^{\beta L S}(jM,j'M'),\end{aligned}\end{split}\]</div>
<p>where the 3-j symbol is defined as indicated by any suitable textbook
on Racah algebra.</p>
</div>
<div class="section" id="statistical-equilibrium-equations">
<h2>Statistical equilibrium equations<a class="headerlink" href="#statistical-equilibrium-equations" title="Permalink to this headline">¶</a></h2>
<p>In order to obtain the <span class="math">\({^{\beta LS}\rho^K_Q(J,J')}\)</span> elements we
have to solve the statistical equilibrium equations. These equations,
written in a reference system in which the quantization axis (<span class="math">\(Z\)</span>)
is directed along the magnetic field vector and neglecting the influence
of collisions, can be written as Landi degl&#8217;Innocenti &amp; Landolfi (2004):</p>
<div class="math">
\[\begin{split}\begin{aligned}
\frac{d}{dt} {^{\beta LS}\rho^K_Q(J,J')} &amp;=&amp; -2\pi \mathrm{i} \sum_{K' Q'}
\sum_{J'' J'''} N_{\beta LS}(KQJJ',K'Q'J''J''') {^{\beta LS}\rho^{K'}_{Q'}(J'',J''')}
\nonumber \\
&amp;+&amp; \sum_{\beta_\ell L_\ell K_\ell Q_\ell J_\ell J_\ell'} {^{\beta_\ell L_\ell
S}\rho^{K_\ell}_{Q_\ell}(J_\ell,J_\ell')}
\mathbb{T}_A(\beta L S K Q J J', \beta_\ell L_\ell S K_\ell Q_\ell J_\ell
J_\ell') \nonumber \\
&amp;+&amp; \sum_{\beta_u L_u K_u Q_u J_u J_u'} {^{\beta_u L_u
S}\rho^{K_u}_{Q_u}(J_u,J_u')}
\Big[ \mathbb{T}_E(\beta L S K Q J J', \beta_u L_u S K_u Q_u J_u J_u') \nonumber \\
&amp; &amp;\qquad \qquad \qquad \qquad \qquad + \mathbb{T}_S(\beta L S K Q
J J', \beta_u L_u S K_u Q_u J_u J_u') \Big] \nonumber \\
&amp;-&amp; \sum_{K' Q' J'' J'''} {^{\beta L S}\rho^{K'}_{Q'}(J'',J''') } \Big[
\mathbb{R}_A(\beta L S K Q J J' K' Q' J'' J''') \nonumber \\
&amp; &amp; + \mathbb{R}_E(\beta L S K Q J J' K'
Q' J'' J''') + \mathbb{R}_S(\beta L S K Q J J' K' Q' J'' J''') \Big].
\label{eq:see}\end{aligned}\end{split}\]</div>
<p>The first term in the right hand side of Eq. ([eq:see]) takes into
account the influence of the magnetic field on the atomic level
polarization. This term has its simplest expression in the chosen
magnetic field reference frame (Landi degl&#8217;Innocenti &amp; Landolfi 2004). In any other
reference system, a more complicated expression arises. The second,
third and fourth terms account, respectively, for coherence transfer due
to absorption from lower levels (<span class="math">\(\mathbb{T}_A\)</span>), spontaneous
emission from upper levels (<span class="math">\(\mathbb{T}_E\)</span>) and stimulated
emission from upper levels (<span class="math">\(\mathbb{T}_S\)</span>). The remaining terms
account for the relaxation of coherences due to absorption to upper
levels (<span class="math">\(\mathbb{R}_A\)</span>), spontaneous emission to lower levels
(<span class="math">\(\mathbb{R}_E\)</span>) and stimulated emission to lower levels
(<span class="math">\(\mathbb{R}_S\)</span>), respectively.</p>
<p>The stimulated emission and absorption transfer and relaxation rates
depend explicitly on the radiation field properties
(see eqs. 7.45 and 7.46 of Landi degl&#8217;Innocenti &amp; Landolfi 2004). The
symmetry properties of the radiation field are accounted for by the
spherical components of the radiation field tensor:</p>
<div class="math">
\[J^K_Q(\nu) = \oint \frac{d\Omega}{4\pi} \sum_{i=0}^3
\mathcal{T}^K_Q(i,\mathbf{\Omega}) S_i(\nu,\mathbf{\Omega}).
\label{eq:jkq}\]</div>
<p>The quantities <span class="math">\(\mathcal{T}^K_Q(i,\mathbf{\Omega})\)</span> are spherical
tensors that depend on the reference frame and on the ray direction
<span class="math">\(\mathbf{\Omega}\)</span>. They are given by</p>
<div class="math">
\[\mathcal{T}^K_Q(i,\mathbf{\Omega}) = \sum_P t^K_P(i) \mathcal{D}^K_{PQ}(R'),
\label{eq:tkq}\]</div>
<p>where <span class="math">\(R'\)</span> is the rotation that carries the reference system
defined by the line-of-sight <span class="math">\(\mathbf{\Omega}\)</span> and by the
polarization unit vectors <span class="math">\(\mathbf{e}_1\)</span> and <span class="math">\(\mathbf{e}_2\)</span>
into the reference system of the magnetic field, while
<span class="math">\(\mathcal{D}^K_{PQ}(R')\)</span> is the usual rotation matrix
Edmonds (1960). Table 5.6 in
Landi degl&#8217;Innocenti &amp; Landolfi (2004) gives the
<span class="math">\(\mathcal{T}^K_Q(i,\mathbf{\Omega})\)</span> values for each Stokes
parameter <span class="math">\(S_i\)</span> (with <span class="math">\(S_0=I\)</span>, <span class="math">\(S_1=Q\)</span>, <span class="math">\(S_2=U\)</span>
and <span class="math">\(S_3=V\)</span>).</p>
</div>
<div class="section" id="emission-and-absorption-coefficients">
<h2>Emission and absorption coefficients<a class="headerlink" href="#emission-and-absorption-coefficients" title="Permalink to this headline">¶</a></h2>
<p>Once the multipolar components <span class="math">\({^{\beta L S}\rho^{K}_{Q}(J,J') }\)</span>
are known, the coefficients <span class="math">\(\epsilon_I\)</span> and <span class="math">\(\epsilon_X\)</span>
(with <span class="math">\(X=Q,U,V\)</span>) of the emission vector and the coefficients
<span class="math">\(\eta_I\)</span>, <span class="math">\(\eta_X\)</span>, and <span class="math">\(\rho_X\)</span> of the propagation
matrix for a given transition between an upper term
<span class="math">\((\beta L_u S)\)</span> and an lower term <span class="math">\((\beta L_\ell S)\)</span> can be
calculated with the expressions of §7.6.b in
Landi degl&#8217;Innocenti &amp; Landolfi (2004). These radiative transfer
coefficients are proportional to the number density of atoms,
<span class="math">\(\mathcal{N}\)</span>. Their defining expressions contain also the Voigt
profile and the Faraday-Voigt profile
(see S5.4 in Landi degl&#8217;Innocenti &amp; Landolfi 2004), which involve the
following parameters: <span class="math">\(a\)</span> (i.e., the reduced damping constant),
<span class="math">\(v_\mathrm{th}\)</span> (i.e., the velocity that characterizes the thermal
motions, which broaden the line profiles), and <span class="math">\(v_\mathrm{mac}\)</span>
(i.e., the velocity of possible bulk motions in the plasma, which
produce a Doppler shift).</p>
<p>It is important to emphasize that the expressions for the emission and
absorption coefficients and those of the statistical equilibrium
equations are written in the reference system whose quantization axis is
parallel to the magnetic field. The following equation indicates how to
obtain the density matrix elements in a new reference system:</p>
<div class="math">
\[\left[ {^{\beta L S}\rho^{K}_{Q}(J,J') } \right]_\mathrm{new} = \sum_{Q'} \left[
{^{\beta L S}\rho^{K}_{Q'}(J,J') } \right]_\mathrm{old}
\mathcal{D}^K_{Q' Q}(R)^*,\]</div>
<p>where <span class="math">\(\mathcal{D}^K_{Q' Q}(R)^*\)</span> is the complex conjugate of the
rotation matrix for the rotation <span class="math">\(R\)</span> that carries the old
reference system into the new one.</p>
</div>
<div class="section" id="inversion">
<h2>Inversion<a class="headerlink" href="#inversion" title="Permalink to this headline">¶</a></h2>
<p>Our inversion strategy is based on the minimization of a merit function
that quantifies how well the Stokes profiles calculated in our
atmospheric model reproduce the observed Stokes profiles. To this end,
we have chosen the standard <span class="math">\(\chi^2\)</span>–function, defined as:</p>
<div class="math">
\[\chi^2 = \frac{1}{4N_\lambda} \sum_{i=1}^4 \sum_{j=1}^{N_\lambda}
\frac{\left[S_i^\mathrm{syn}(\lambda_j)-S_i^\mathrm{obs}(\lambda_j) \right]^2}{
\sigma_i^2(\lambda_j)} ,\]</div>
<p>where <span class="math">\(N_\lambda\)</span> is the number of wavelength points and
<span class="math">\(\sigma_i^2(\lambda_j)\)</span> is the variance associated to the
<span class="math">\(j\)</span>-th wavelength point of the <span class="math">\(i\)</span>-th Stokes profiles. The
minimization algorithm tries to find the value of the parameters of our
model that lead to synthetic Stokes profiles <span class="math">\(S_i^\mathrm{syn}\)</span>
with the best possible fit to the observations. For our slab model, the
number of parameters (number of dimensions of the <span class="math">\(\chi^2\)</span>
hypersurface) lies between 5 and 7, the maximum value corresponding to
the optically thick case. The magnetic field vector (<span class="math">\(B\)</span>,
<span class="math">\(\theta_B\)</span> and <span class="math">\(\chi_B\)</span>), the thermal velocity
(<span class="math">\(v_\mathrm{th}\)</span>) and the macroscopic velocity
(<span class="math">\(v_\mathrm{mac}\)</span>) are always required. This set of parameters is
enough for the case of an optically thin slab. In order to account for
radiative transfer effects, we need to define the optical depth of the
slab along its normal direction and at a suitable reference wavelength
(e.g., the central wavelength of the red blended component for the 10830
Å&nbsp;multiplet). In addition, we may additionally need to include the
damping parameter (<span class="math">\(a\)</span>) of the Voigt profile if the wings of the
observed Stokes profiles cannot be fitted using Gaussian line profiles.</p>
</div>
<div class="section" id="global-optimization-techniques">
<h2>Global Optimization techniques<a class="headerlink" href="#global-optimization-techniques" title="Permalink to this headline">¶</a></h2>
<p>In order to avoid the possibility of getting trapped in a local minimum
of the <span class="math">\(\chi^2\)</span> hypersurface, global optimization methods have to
be used. We have chosen the DIRECT algorithm
Jones et al. (1993), whose name derives from one of its
main features: <em>di</em>viding <em>rect</em>angles. The idea is to recursively
sample parts of the space of parameters, improving in each iteration the
location of the part of the space where the global minimum is
potentially located. The decision algorithm is based on the assumption
that the function is Lipschitz continuous. The method works
very well in practice and can indeed find the minimum in functions that
do not fulfill the condition of Lipschitz continuity. The reason is that
the DIRECT algorithm does not require the explicit calculation of the
Lipschitz constant but it uses all possible values of such a constant to
determine if a region of the parameter space should be broken into
subregions because of its potential interest.</p>
<p>Since the intensity profile is not very sensitive to the presence of a
magnetic field (at least for magnetic field strengths of the order of or
smaller than 1000 G), we have decided to estimate the optical thickness
of the slab, the thermal and the macroscopic velocity of the plasma and
the damping constant by using only the Stokes <span class="math">\(I\)</span> profile, and
then to determine the magnetic field vector by using the polarization
profiles. The full inversion scheme begins by applying the DIRECT method
to obtain a first estimation of the indicated four parameters by using
only Stokes <span class="math">\(I\)</span>. Afterwards, some LM iterations are carried out to
refine the initial values of the model’s parameters obtained in the
previous step. Once the LM method has converged, the inferred values of
<span class="math">\(v_\mathrm{th}\)</span>, <span class="math">\(v_\mathrm{mac}\)</span> (together with <span class="math">\(a\)</span>
and <span class="math">\(\Delta \tau\)</span>, when these are parameters of the model) are
kept fixed in the next steps, in which the DIRECT method is used again
for obtaining an initial approximation of the magnetic field vector
(<span class="math">\(B\)</span>,<span class="math">\(\theta_B\)</span>,<span class="math">\(\chi_B\)</span>). According to our
experience, the first estimate of the magnetic field vector given by the
DIRECT algorithm is typically very close to the final solution.
Nevertheless, some iterations of the LM method are performed to refine
the value of the magnetic field strength, inclination and azimuth. In
any case, although we have found very good results with this procedure,
the specific inversion scheme is fully configurable and can be tuned for
specific problems.</p>
<p>Our experience has proved that the following strategy is appropriate for
inverting prominences. Two initial DIRECT+LM cycles with weights
<span class="math">\((1,0,0,0)\)</span> to invert the thermodynamical parameters. Then, two
DIRECT+LM cycles in which <span class="math">\(B\)</span>, <span class="math">\(\theta_B\)</span> and <span class="math">\(\chi_B\)</span>
are left free with weights <span class="math">\((0,0.1,0.1,1)\)</span> which tries to set the
correct polarity of the field given by Stokes <span class="math">\(V\)</span>. An additional
LM cycle in which we fit only <span class="math">\(\theta_B\)</span> and <span class="math">\(\chi_B\)</span> with
the weights <span class="math">\((0,1,1,0.3)\)</span> and a last LM cycle with weights
<span class="math">\((0,0.3,0.3,1)\)</span> leaving the full magnetic field vector free.</p>
</div>
<div class="section" id="convergence">
<h2>Convergence<a class="headerlink" href="#convergence" title="Permalink to this headline">¶</a></h2>
<p>We let the DIRECT algorithm locate the global minimum in a region whose
hypervolume is <span class="math">\(V\)</span>. This hypervolume is obtained as the product of
the length <span class="math">\(d_i\)</span> of each dimension associated with each of the
<span class="math">\(N\)</span> parameters:</p>
<div class="math">
\[V = \prod_i^N d_i.\]</div>
<p>When the hypervolume decreases by a factor <span class="math">\(f\)</span> after the DIRECT
algorithm has discarded some of the hyperrectangles, its size along each
dimension is approximately decreased by a factor <span class="math">\(f^{1/N}\)</span>. In
order to end up with a small region where the global minimum is located,
many subdivisions are necessary, thus requiring many function
evaluations.</p>
<p>The most time consuming part of any optimization procedure is the
evaluation of the merit function. The DIRECT algorithm needs only a
reduced number of evaluations of the merit function to find the region
where the global minimum is located. For this reason, we have chosen it
as the initialization part of the LM method. Since the initialization
point is close to the global minimum, the LM method, thanks to its
quadratic behavior, rapidly converges to the minimum.</p>
</div>
<div class="section" id="stopping-criterium">
<h2>Stopping criterium<a class="headerlink" href="#stopping-criterium" title="Permalink to this headline">¶</a></h2>
<p>We have used two stopping criteria for the DIRECT algorithm. The first
one is stopping when the ratio between the hypervolume where the global
minimum is located and the original hypervolume is smaller than a given
threshold. This method has been chosen when using the DIRECT algorithm
as an initialization for the LM method, giving very good results. The
other good option, suggested by Jones et al. (1993), is
to stop after a fixed number of evaluations of the merit function.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ambiguities.html" class="btn btn-neutral float-right" title="Ambiguities in the Hanle effect in the saturation regime" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="prepareData.html" class="btn btn-neutral" title="Data preparation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Andres Asensio Ramos.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0beta1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>