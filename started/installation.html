<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. Installation &mdash; Hazel 2.0beta1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/documentation_options.js?v=2c8e27ff"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2. Basic usage" href="../started.html" />
    <link rel="prev" title="Hazel v2.0" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Hazel
          </a>
              <div class="version">
                2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#generalities">1.1. Generalities</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation-from-source">1.2. Installation from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requirements">1.3. Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#container">1.4. Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="#for-developers">1.5. For developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#documentation">1.6. Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#issues">1.7. Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supercomputers">1.8. Supercomputers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../started.html">2. Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">3. Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io_files.html">4. Input/output files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preparation.html">5. Data preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">6. Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../graphical.html">7. Graphical front-end</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">8. Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">9. API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgements.html">10. Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../disclaimer.html">11. Disclaimer</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Hazel</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">1. </span>Installation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/started/installation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installation">
<h1><span class="section-number">1. </span>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h1>
<section id="generalities">
<h2><span class="section-number">1.1. </span>Generalities<a class="headerlink" href="#generalities" title="Link to this heading">¶</a></h2>
<p>Hazel v2.0 is a Python 3 module with some wrapped compiled Fortran routines. It should
be pretty easy to install once you have a working compiler in your system.</p>
<p>There are different ways to install Hazel v2.0, but the best is to install
it into a virtual environment either with <a class="reference external" href="http://www.virtualenv.org">pip</a> or <a class="reference external" href="https://conda.io/docs/user-guide/tasks/manage-environments.html">conda</a>,
which makes everything much more safer, plus making sure that all packages are installed for the code.
For example, once you have installed <a class="reference external" href="https://conda.io/miniconda.html">Miniconda</a>, you can generate
a new environment and install the dependencies (you can install whatever version of Python 3 you desire).
For consistency, it is better to use the gfortran compilers from Anaconda. In the
following we show how install all packages with Anaconda. Anyway, feel free to use
the gfortran compiler from your system but you might have some issues.</p>
<p>For a Linux OS, type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">hazel_env</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.10</span>
<span class="n">conda</span> <span class="n">activate</span> <span class="n">hazel_env</span>
<span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">cython</span> <span class="n">numpy</span> <span class="n">h5py</span> <span class="n">tqdm</span> <span class="n">scipy</span> <span class="n">astropy</span> <span class="n">mpich</span> <span class="n">mpi4py</span> <span class="n">configobj</span> <span class="n">gfortran</span> <span class="n">setuptools</span> <span class="n">asciitree</span>
</pre></div>
</div>
<p>A different version of Python can be installed in the environment. For Mac OS, type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">hazel_env</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.10</span>
<span class="n">conda</span> <span class="n">activate</span> <span class="n">hazel_env</span>
<span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">cython</span> <span class="n">numpy</span> <span class="n">h5py</span> <span class="n">tqdm</span> <span class="n">scipy</span> <span class="n">astropy</span> <span class="n">mpich</span> <span class="n">mpi4py</span> <span class="n">configobj</span> <span class="n">gfortran_osx</span><span class="o">-</span><span class="mi">64</span> <span class="n">gcc_osx</span><span class="o">-</span><span class="mi">64</span> <span class="n">asciitree</span>
</pre></div>
</div>
<p>The specific packages for the Fortran and C compilers might change depending on the version of Anaconda
that you have installed in your system. Their name might also be <cite>gfortran</cite> and <cite>gcc</cite> or simply <cite>compilers</cite>.
Feel free to add <cite>matplotlib</cite> for doing some plots. You will need it if you want to run some of the examples
shown in this documentation in your computer.</p>
<p>If you also want to use the GUI, you need to add two new dependencies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">hazel_env</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.10</span>
<span class="n">conda</span> <span class="n">activate</span> <span class="n">hazel_env</span>
<span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">cython</span> <span class="n">numpy</span> <span class="n">h5py</span> <span class="n">tqdm</span> <span class="n">scipy</span> <span class="n">astropy</span> <span class="n">mpich</span> <span class="n">mpi4py</span> <span class="n">configobj</span> <span class="n">gfortran_linux</span><span class="o">-</span><span class="mi">64</span> <span class="n">gcc_linux</span><span class="o">-</span><span class="mi">64</span> <span class="n">matplotlib</span> <span class="n">pyqt</span> <span class="n">asciitree</span>
</pre></div>
</div>
<p>Remember to add <cite>ipython</cite> if you are using this shell to run Hazel v2.0. Otherwise, it will use
<cite>ipython</cite> from another environment and you can get confused.</p>
<p>If you want to use the NLTE neural option for synthesizing the Ca II 854.2 nm line, the packages <code class="docutils literal notranslate"><span class="pre">pytorch</span></code>,
<code class="docutils literal notranslate"><span class="pre">pytorch_geometric</span></code> and <code class="docutils literal notranslate"><span class="pre">pytorch-scatter</span></code> should be installed. Take a look at the documentation for <a class="reference external" href="https://pytorch.org/">PyTorch</a>
, <a class="reference external" href="https://pytorch-geometric.readthedocs.io/en/latest/">PyTorch Geometric</a> <a class="reference external" href="https://github.com/rusty1s/pytorch_scatter">PyTorch Scatter</a> for more information.
A typical installation using <cite>pip</cite> can be done using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">torch</span> <span class="n">torchvision</span> <span class="n">torchaudio</span> <span class="o">--</span><span class="n">index</span><span class="o">-</span><span class="n">url</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="o">.</span><span class="n">pytorch</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">whl</span><span class="o">/</span><span class="n">cpu</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">torch_geometric</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">pyg_lib</span> <span class="n">torch_scatter</span> <span class="n">torch_sparse</span> <span class="n">torch_cluster</span> <span class="n">torch_spline_conv</span> <span class="o">-</span><span class="n">f</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">data</span><span class="o">.</span><span class="n">pyg</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">whl</span><span class="o">/</span><span class="n">torch</span><span class="o">-</span><span class="mf">2.2.0</span><span class="o">+</span><span class="n">cpu</span>
</pre></div>
</div>
</section>
<section id="installation-from-source">
<h2><span class="section-number">1.2. </span>Installation from source<a class="headerlink" href="#installation-from-source" title="Link to this heading">¶</a></h2>
<p>Since Hazel v2.0 is still in a heavy development phase, the only possible way of
installing the code is via compilation of the sources.
Once your environment is activated (or in your base environment if you prefer not to
use a different environment), the sources can be installed by cloning this repository and installing it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">aasensio</span><span class="o">/</span><span class="n">hazel2</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>
</pre></div>
</div>
<p>Do not forget to often pull from the <a class="reference external" href="https://github.com/aasensio/hazel2">repository</a> and recompile
the code by typing the following from the location of the sources:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">pull</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>
</pre></div>
</div>
<p>Improvements are pushed all the time in Hazel v2.0. In case you do not want
to reinstall it after every pull or you are in fact helping on the development
of the code, you can also install it in develop mode:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">pull</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">develop</span>
</pre></div>
</div>
</section>
<section id="requirements">
<h2><span class="section-number">1.3. </span>Requirements<a class="headerlink" href="#requirements" title="Link to this heading">¶</a></h2>
<p>Hazel v2.0 depends on the following external packages, that should be
pretty straightforward to install:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">numpy</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">h5py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scipy</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astropy</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mpich</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mpi4py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">configobj</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tqdm</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">asciitree</span></code></p></li>
</ul>
<p>If you want to use the GUI, you also need to install the following dependencies:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pyqt5</span></code></p></li>
</ul>
<p>All of them can be installed in Anaconda with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="n">numpy</span> <span class="n">h5py</span> <span class="n">scipy</span> <span class="n">astropy</span> <span class="n">mpi4py</span> <span class="n">configobj</span> <span class="n">tqdm</span> <span class="n">pyqt</span> <span class="n">maplotlib</span>
</pre></div>
</div>
</section>
<section id="container">
<h2><span class="section-number">1.4. </span>Container<a class="headerlink" href="#container" title="Link to this heading">¶</a></h2>
<p>A simple way of installing Hazel v2.0, at least in Linux systems or supercomputers, is to use
this Apptainer <a class="reference external" href="https://cloud.iac.es/index.php/s/BqG2jGRsqHtJMW9">container</a>.
This container has all the dependencies installed and it is ready to be used. You can download it (we try to
keep this version as updated as possible) and run it with Apptainer as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apptainer</span> <span class="n">run</span> <span class="n">hazel</span><span class="o">.</span><span class="n">sif</span> <span class="n">python</span> <span class="n">invert</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>In principle, you can build your own container by going to the <cite>apptainer</cite> directory in the
distribution and running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apptainer</span> <span class="n">build</span> <span class="n">hazel</span><span class="o">.</span><span class="n">sif</span> <span class="n">hazel</span><span class="o">.</span><span class="k">def</span>
</pre></div>
</div>
</section>
<section id="for-developers">
<h2><span class="section-number">1.5. </span>For developers<a class="headerlink" href="#for-developers" title="Link to this heading">¶</a></h2>
<p>Remember that if you want to be involved in the development of the code, it is perhaps more
useful to install the code using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">develop</span>
</pre></div>
</div>
<p>so that you can immediately test the changes to the code. This development
version can be uninstalled by typing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">develop</span> <span class="o">--</span><span class="n">uninstall</span>
</pre></div>
</div>
</section>
<section id="documentation">
<h2><span class="section-number">1.6. </span>Documentation<a class="headerlink" href="#documentation" title="Link to this heading">¶</a></h2>
<p>For the compilation of the docs, you will need the following packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sphinx</span> <span class="n">numpydoc</span> <span class="n">sphinx_rtd_theme</span> <span class="n">nbsphinx</span>
</pre></div>
</div>
</section>
<section id="issues">
<h2><span class="section-number">1.7. </span>Issues<a class="headerlink" href="#issues" title="Link to this heading">¶</a></h2>
<p>MacOSX Catalina has some issues with the paths to the include files. Defining the following environment variables might help.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">CFLAGS</span><span class="o">=</span><span class="s2">&quot;-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk&quot;</span>
<span class="n">export</span> <span class="n">CCFLAGS</span><span class="o">=</span><span class="s2">&quot;-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk&quot;</span>
<span class="n">export</span> <span class="n">CXXFLAGS</span><span class="o">=</span><span class="s2">&quot;-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk&quot;</span>
<span class="n">export</span> <span class="n">CPPFLAGS</span><span class="o">=</span><span class="s2">&quot;-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk&quot;</span>
</pre></div>
</div>
</section>
<section id="supercomputers">
<h2><span class="section-number">1.8. </span>Supercomputers<a class="headerlink" href="#supercomputers" title="Link to this heading">¶</a></h2>
<p>Configuring Hazel v2.0 for running in supercomputers should be easy. We recommend
to locally create an Anaconda installation with the needed packages and follow
the details given by the supercomputer staff.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="Hazel v2.0" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../started.html" class="btn btn-neutral float-right" title="2. Basic usage" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, Andres Asensio Ramos.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>